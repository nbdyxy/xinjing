<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>个人共修</title>

	<link rel="stylesheet" type="text/css" media="all" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" th:href="@{https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css}"/>

	<!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<style type="text/css">
    	body {
    		max-width: 768px;
    		min-width: 320px;
    		margin: 0 auto;
    		display: block;
    		font-family: 'Microsoft YaHei UI', 'Microsoft YaHei', SimSun, 'Segoe UI', Tahoma, Helvetica, Sans-Serif;
    		font-size: 18px;
    		/*font-family: "Helvetica Neue", Helvetica, Arial, sans-serif";*/
    	}
    	.header {
    		 background-color: #f7ebde;
    	}
		.logo {
			height: 300px;
			width: 100%;
			text-align: center; 
			vertical-align: middle;
		}
		.logo_mid {
			display: block; 
			max-width: 100%; 
			height: 90px; 
			margin:0 auto;
		}
    	.title {
 			background-size: 100% 100%;
			background-position: center;
			border-radius: 5px;
			margin: 0 auto;
			height: 90px;
			width: 100%;
		}
		.my-activity {
			height: 30px;
			font-size: 20px;
			width: 100%;
		}
    	.nav-header {
    		top: 0;
    		min-height: 60px;
		    margin-bottom: 0;
		    border-width: 0;
		    border-radius: 0;
		    transition-property: color, background-color, box-shadow;
		    transition-duration: .25s;
		    transition-timing-function: ease-in-out;
		    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.25);
		    z-index: 10;
		    background-color: #e2bb86;
		    color: black;
		    position: relative;
    	}
    	.my-nav {
    		list-style: none;
    		padding-left: 0;
		    margin-bottom: 0;
		    background-color: #f3ebe0;
    	}
    	.my-nav li {
    		float: left;
    		line-height: 60px;
    		font-size: 20px;
    		text-align: center;
    		border-radius: 5px;
    	}
    	.my-nav li a {
    		text-decoration: none;
    		color: black;
    	}
    	.my-nav .active {
		    background-color: #82350c;
		    color: #fff;
    	}
    	.my-nav .active a{
		    color: #fff;
    	}
    	.content {
    		 background-color: #f7ebde;
    	}
    	.figure {
			background-size: 100% 100%;
			background-position: center;
			border-radius: 5px;
			margin: 0 auto;
			background-color: #f7ebde;
			padding: 10px;
		}
		.my-panel {
			border: 1px solid #bbb6b6; 
			border-radius: 5px; 
			margin-bottom: 10px;
		} 
		.my-panel-title {
			margin-bottom: 5px; 
			padding-left: 15px; 
			font-size: 20px; 
			line-height: 36px; 
			border-bottom: 1px solid #bbb6b6;
		}
		.container {
			width: 100%;
		}
		.my-col-left {
			padding: 2px 0; 
			text-align: left;
		}
		.my-col-center {
			padding: 2px 0; 
			text-align: center;
		}
		.my-col-right {
			padding: 2px 0; 
			text-align: right;
		}
		.progress {
			background-color: rgba(255, 255, 255, 0);
		}
		.my-divider {
			margin: 0 auto; 
			width: 98%; 
			border: .5px dashed grey; 
			opacity: .52;
		}
		.my-row {
			width: 100%; 
			margin: 5px 0; 
			text-align: center;
		}
		.form-control, input {
			background-color: rgba(0, 0, 0, 0);
			font-size: 18px;
		}
		.input-group-addon {
			background-color: rgba(0, 0, 0, 0);
		}
		a {
			text-decoration: none;
			background-color: transparent;
		}
		.modal-open {
			overflow: inherit;
			padding-right: 0px !important;
		}
		.modal-header {
			padding: 15px;
			border-bottom: 1px solid #cc3d3d;
			background-color: #f5580d;
			border-radius: 5px;
			color: #fff;
		}
		#dailyValue {
			width: 50%; 
			text-align: center; 
			background-color: rgba(0, 0, 0, 0); 
			border: none; 
			border-bottom: 1px solid #ff7500;
		}
		#dailyConfirm {
			background-color: #4d89d4; 
			border-color: #4d89d4;
		}
		.footer {
			height: 50px;
			bottom: 0;
			zoom: 1;
			background-repeat: no-repeat;
			background-position: center 0;
			background-image: url(../static/images/zongzhi_min.png);
			background-color: #f7ebde;
		}
		.list-group-item {
			background-color: rgba(255, 255, 255, 0) !important;
			border: 1px solid #d6a218;
		}
		.badge {
			background-color: #d29133;
		}
		.fold {
			position: absolute;
			top: -9999px;
		}
		@media (max-width:1024px) {
			.logo {
				height: 300px;
			}
			.my-table {
				font-size: 20px;
			}
			.password-help {
				font-size: 18px;
			}
		}
		@media (max-width:768px) {
			.logo {
				height: 260px;
			}
			.my-table {
				font-size: 20px;
			}
			.password-help {
				font-size: 15px;
			}
		}
		@media (max-width:500px) {
			.logo {
				height: 180px;
			}
			.my-table {
				font-size: 15px;
			}
			.password-help {
				font-size: 13px;
			}
		}
		.mod_aside_v2 {
		    position: fixed;
		    z-index: 10;
		    right: 0;
		}
		.mod_aside_v2_mask {
		    position: fixed;
		    left: 0;
		    right: 0;
		    top: 0;
		    bottom: 0;
		    background: rgba(0,0,0,.3);
		    opacity: 0;
		    display: none;
		    transition: opacity .3s;
		}
		.mod_aside_v2_nav {
		    position: absolute;
		    bottom: 0;
		    right: 200px;
		    width: 102px;
		    padding: 15px 0 5px;
		    background: #fff;
		    border-radius: 4px 0 0 4px;
		    height: 260px;
		    z-index: 1;
		    transform: translate3d(100%,0,0);
		    transition: transform .3s,-webkit-transform .3s;
		}
		.mod_aside_v2_nav_btn {
		    width: 55px;
		    height: 60px;
		    background: rgba(0,0,0,.7);
		    position: absolute;
		    left: -55px;
		    top: 50%;
		    margin-top: -20px;
		    border-radius: 4px 0 0 4px;
		}
		.mod_aside_v2_nav_btn:before {
		    content: "";
		    position: absolute;
		    left: 2px;
		    top: 50%;
		    width: 20px;
		    height: 20px;
		    margin-top: -10px;
/* 		    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAABGdBT…Rn09psIeQEkmOWuEpBkAwt7ItkXPCyGk4Uv/IVnvmNeQF/yATH2rqnlQAAAABJRU5ErkJggg==) no-repeat 0 0;
 */		    background-size: 100%;
		}
		.mod_aside_v2_nav_btn i {
		    color: #fff;
		    font-size: 18px;
		    width: 2.2em;
		    line-height: 1.3em;
		    position: absolute;
		    top: 50%;
		    left: 15px;
		    transform: translateY(-50%);
		}
		em, i {
		    font-style: normal;
		}
		.mod_aside_v2_nav_item {
		    float: left;
		    width: 33%;
		    text-align: center;
		    padding: 5px 0;
		    position: relative;
		    text-decoration: none;
		    color: #333;
		}
		.mod_aside_v2_nav_item img {
		    display: block;
		    width: 24px;
		    height: 24px;
		    margin: 0 auto;
		    fill: #666;
		}
		.btn-disabled {
			background-color: #455a6b;
		}
		.btn-active {
			background-color: #52a3e8;
		}
		.error {
			color: red;
			font-weight: bold;
		}
		.dialog {
			position: fixed;
			width: 180px;
			height: 70px;
			top: 50%;
			margin-top: -35px;
			left: 50%;
			margin-left: -90px;
			background: rgba(0, 0, 0, .7);
			border-radius: 10px;
			text-align: center;
			vertical-align: top;
			z-index: 999;
		}
		
		.dialog .dialog-wrap {
			display: table;
			width: 100%;
			height: 100%;
		}
		
		.dialog .dialog-mid {
			display: table-cell;
			vertical-align: middle;
		}
		
		.dialog .warn {
			color: #fff;
			font-size: 18px;
			vertical-align: middle;
		}
		
		.hide {
			display: none;
		}
    </style>
  </head>
  <body>
  	<div class="dialog hide" id="tips">
		<div class="dialog-wrap">
			<div class="dialog-mid">
				<span class="warn"></span>
			</div>
		</div>
	</div>
	<div class="header">
		<div class="info">
			<div class="logo hide"></div>
			<div class="title">
				<img class="img-responsive logo_mid" src="../static/images/pingtai.png" th:src="@{/images/pingtai.png}" alt="共修平台">
			</div>
			<marquee scrolldelay="220" class="my-activity">第五次百万《心经》共修活动</marquee>
		</div>
		<nav class="nav-header">
			<ul class="my-nav">
				<li id="jianjie"><a href="index.html" th:href="@{/index}">简介</a></li>
				<li id="dongtai"><a href="dongtai.html" th:href="@{/dongtai}">动态</a></li>
				<li id="huixiang"><a href="huixiang.html" th:href="@{/huixiang}">回向</a></li>
				<li id="gongxiu" class="active"><a href="gongxiu_personally.html" th:href="@{/login}">共修</a></li>
			</ul>
		</nav>
	</div>
	<div class="content">
		<div class="figure">
			<div class="row my-row">
				<div class="col-xs-8 col-xs-offset-4 my-col-right">
					<div style="line-height: 34px; position: absolute; right: 90px; width: 100px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
						<a th:text="${userInfo.username}" href="/user/info" th:href="@{/user/info}">
							用户名
						</a>
					</div>
					<!-- <button type="button" 
						class="btn btn-default" data-toggle="modal"
						data-target="#userInfoDialog"
						style="background-color: #efab5b; border-color: #efab5b; font-size: 18px; margin-bottom: 5px;">
						
					</button> -->
					<!-- <button type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="bottom" data-content="Vivamus
sagittis lacus vel augue laoreet rutrum faucibus.">
  Popover on 底部
</button>
					<a tabindex="0" class="btn btn-lg btn-danger" placement="bottom" role="button" data-toggle="popover" data-trigger="focus" title="Dismissible popover" data-content="And here's some amazing content. It's very engaging. Right?"><b th:text="${userInfo.username}" style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">用户名</b></a>
					 -->
					<!-- <span th:text="${userInfo.username}" style="line-height: 34px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">用户名</span> -->
					<a href="/logout" th:href="@{/logout}" class="btn btn-danger" role="button">
						退出登录
					</a>
				</div>
			</div>
			<div class="my-panel">
				<div class="my-panel-title">个人动态</div>
				<div class="container">
					<div class="col-xs-6 my-col-left"></div>
					<div class="col-xs-4 my-col-center"
						style="font-weight: bold;">遍数</div>
					<div class="col-xs-2 my-col-right"
						style="font-weight: bold;">排名</div>
				</div>
				<div class="my-divider"></div>
				<div class="container">
					<div class="row my-row">
						<div class="col-xs-6 my-col-left">本日报数</div>
						<div id="today-count" class="col-xs-4 my-col-center" th:with="today=${personalCountOffTopFive[0]}" th:text="${today.record_number}">10</div>
						<div id="daily-rank" class="col-xs-2 my-col-right" th:text="${rankMap['daily_rank']}">-</div>
					</div>
					<div class="row my-row" th:with="ws_map=${statisticMap['ws_map']}">
						<div class="col-xs-6 my-col-left">本周汇总</div>
						<div id="weekly-total" class="col-xs-4 my-col-center" th:text="${ws_map['weekly_total']}">89</div>
						<div id="week-rank" class="col-xs-2 my-col-right" th:text="${rankMap['week_rank']}">-</div>
					</div>
					<div class="row my-row" th:with="ms=${statisticMap['ms']}">
						<div class="col-xs-6 my-col-left">本月汇总</div>
						<div id="month-total" class="col-xs-4 my-col-center" th:text="${ms} ? ${ms.month_total} : 0">325</div>
						<div id="month-rank" class="col-xs-2 my-col-right" th:text="${rankMap['month_rank']}">-</div>
					</div>
					<div class="row my-row" th:with="ys=${statisticMap['ys']}">
						<div class="col-xs-6 my-col-left">本年总计</div>
						<div id="year-total" class="col-xs-4 my-col-center" th:text="${ys} ? ${ys.year_total}: 0">2661</div>
						<div id="year-rank" class="col-xs-2 my-col-right" th:text="${rankMap['year_rank']}">-</div>
					</div>
					<div class="row my-row">
						<div class="col-xs-6 my-col-left">本年日均</div>
						<div id="year-avg" class="col-xs-4 my-col-center" th:text="${year_avg} > 0 ? ${year_avg} : '-'">2661</div>
						<div id="year-avg-rank" class="col-xs-2 my-col-right">-</div>
					</div>
				</div>
			</div>
			<div class="my-panel">
				<div class="my-panel-title">今日报数</div>
				<div class="container" style="margin: 5px 0;" th:with="today=${personalCountOffTopFive[0]}">
					<div id="textToday" class="col-xs-7 my-col-left" th:text="${today.record_number}" style="text-align: center;">123</div>
					<div id="inputToday" class="col-xs-7 my-col-center hide">
						<input type="number" style="text-align: center; width: 80%; border: 0; border-bootom: 1px solid #bda0a0" value="0" />
					</div>
					<div class="col-xs-5 my-col-right">
						<button type="button" id="changeToday" class="btn btn-danger btn-xs" style="font-size: 18px;">修改</button>
						<button type="button" id="updateToday" disabled="disabled" class="btn btn-disabled btn-xs hide" style="color: white; font-size: 18px;">确认</button>
						<button type="button" id="cancelToday" class="btn btn-danger btn-xs hide" style="font-size: 18px;">取消</button>
					</div>
				</div>
				<div class="col-xs-offset-2 error"></div>
			</div>
			<div class="my-panel">
				<div class="my-panel-title">
					报数记录
				</div>
				<div class="container" style="margin: 5px 0;">
					<div class="col-xs-5 my-col-left my-col-center"
						style="font-weight: bold;">时间</div>
					<div class="col-xs-5 col-xs-offset-2 my-col-center"
						style="font-weight: bold;">遍数</div>
				</div>
				<div class="my-divider"></div>
				<div class="container number-record">
					<!-- 
					<div class="row"  style="width: 100%; margin: 5px 0; text-align: center;">
						<div class="col-xs-6" style="padding: 2px 0; text-align: left;">2018-04-28</div>
						<div id="textToday" class="col-xs-4" style="padding: 2px 0; text-align: center;">12遍</div>
						<div id="inputToday" class="col-xs-4 hide" style="padding: 2px 0; text-align: center;">
							<input type="text" value="12" style="width: 100%; text-align: center; background-color: rgba(0, 0, 0, 0); border: none; border-bottom: 1px solid #ff7500;"/>
						</div>
						<div class="col-xs-2" style="padding: 2px 0; text-align: right;">
							<button type="button" class="btn btn-danger btn-xs dailyCommit" style="font-size: 15px;" data-toggle="modal" data-target="#dailyModal" style="background-color: #efab5b; border-color: #d67a00; margin: 5px 5px 15px;">修改</button>
						</div>
					</div>
					 -->
					<!-- <button type="button" id="changeToday" class="btn btn-danger btn-xs" style="font-size: 15px;">修改</button> -->

					<!-- 
					<div class="row"  style="width: 100%; margin: 5px 0; text-align: center;">
						<div class="col-xs-4 col-xs-offset-6" style="padding: 2px 0; text-align: center;">
							<button type="button" id="updateToday" class="btn btn-primary btn-xs hide" style="font-size: 15px;">确认</button>
							<button type="button" id="cancelToday" class="btn btn-danger btn-xs hide" style="font-size: 15px;">取消</button>
						</div>
					</div>
					 -->
					<div class="row my-row" th:each="p, pStat : ${personalCountOffTopFive}">
						<!-- 
						<div th:if="${pStat.first}" class="col-xs-5 my-col-left" th:text="${#dates.format(p.record_date, 'yyyy-MM-dd')}">
							2018-06-28
						</div>
						<div id="textToday" th:if="${pStat.first}" class="col-xs-3 my-col-center" th:text="${p.record_number}">
							101
						</div>
						<div id="inputToday" class="col-xs-3 hide" th:if="${pStat.first}" style="padding: 2px 0; text-align: center;">
							<input type="number" value="0" style="width: 100%; text-align: center; background-color: rgba(0, 0, 0, 0); border: none; border-bottom: 1px solid #bda0a0;"/>
						</div>
						<div th:if="${pStat.first}" class="col-xs-4">
							<button type="button" id="changeToday" class="btn btn-xs btn-active dailyCommit" style="color: #fff; background-color: #efab5b; border-color: #efab5b; font-size: 16px;">修改</button>
						</div>
						<div th:if="${pStat.first}" class="col-xs-12">
							<button type="button" id="updateToday" class="btn btn-active btn-xs hide" style="font-size: 16px;">确认</button>
							<button type="button" id="cancelToday" class="btn btn-danger btn-xs hide" style="font-size: 16px;">取消</button>
						</div>
						
						<div th:unless="${pStat.first}" class="col-xs-5 my-col-left" th:text="${#dates.format(p.record_date, 'yyyy-MM-dd')}">2018-06-28</div>
						<div th:unless="${pStat.first}" class="col-xs-3 my-col-center" th:text="${p.record_number}">10</div>
						 -->
						<div class="col-xs-5 my-col-left" th:text="${#dates.format(p.record_date, 'yyyy-MM-dd')}">2018-06-28</div>
						<div th:id="${pStat.index} == 0 ? first : other" class="col-xs-5 col-xs-offset-2  my-col-center" th:text="${p.record_number}">10</div>
					</div>
					<div th:if="${personalCountOffTopFive.size()}  == 5">
						<div class="my-divider"></div>
						<div class="col-xs-6 col-xs-offset-6 my-col-right">
							<a href="/history" th:href="@{/personalcountoff/history}">查看历史报数</a>
						</div>
					</div>	
				</div>
			</div>
			<div>
				<!-- 
				<button type="button" onclick="javascript:commit();"
					class="btn btn-primary btn-block daily-commit" data-toggle="modal"
					data-target="#baoshuDialog"
					style="background-color: #efab5b; border-color: #efab5b; font-size: 18px; margin-bottom: 5px;">
					<b>提交报数</b>
				</button>
				 -->
				<button type="button"
					class="btn btn-primary btn-block daily-commit"
					style="background-color: #efab5b; border-color: #efab5b; font-size: 18px; margin-bottom: 5px;">
					<b>提交报数</b>
				</button>
			</div>
		</div>
	</div>
	<!-- <div class="hide">
		<input th:field="${serverTime}" />
	</div> -->
	<div class="footer" th:attr="style='background:url('+@{/images/zongzhi_min.png}+');background-color:#f7ebde; background-repeat: no-repeat; background-position: center 0'"></div>
	
	<!-- 
	Modal 报数
	<div class="modal fade" id="baoshuDialog" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel">
		<div class="modal-dialog modal-sm" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" id="myModalLabel">请输入今日报数</h4>
				</div>
				<div class="modal-body" style="text-align: center;">
					<input id="dailyValue" type="number"/>
					<div class="error"></div>
				</div>
				<div class="modal-footer">
					<button id="dailyConfirm" type="button" class="btn btn-primary btn-disabled" disabled="disabled">提交</button>
					<button type="button" class="btn btn-danger" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>
	 -->
	
	<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
	<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
	<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
	<script
		src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script type="text/javascript">
    	var countoffReg = /^([1-9]\d{0,3})$/;
	    function commit() {
			if (todayNumber) {
				$("#dailyValue").val(todayNumber);
			} else {
				console.log("todayNumber is null!");
			} 
		}
		$(function(){
			$('[data-toggle="popover"]').popover();
			function dynamic_page() {
    			var width = $("body").width();
    			var height = $(window).height();
        		var length = $(".my-nav").children("li").length;
        		var avg_width = width / length;
        		var header_height = $(".header").height();
        		var figure_height = $(".figure").height() + 20;
        		var cal_height = height - header_height - 50;
        		/* 
        		figure_height = cal_height > figure_height ? cal_height : figure_height;
        		console.log("height: " + height);
        		console.log("header_height: " + header_height);
        		console.log("figure_height: " + figure_height);
        		console.log("cal_height: " + cal_height);
        		 */
        		$(".my-nav").children("li").css("width", avg_width + "px");
        		if (figure_height > cal_height) {
	        		$(".figure").css("height", "");
        		} else {
	        		$(".figure").css("height", cal_height + "px");
        		}
    		}
			dynamic_page();
			$(window).resize(function() {
				dynamic_page();
			});
			window.onscroll=function(){
				var top = $(".content").offset().top - $(window).scrollTop();
				var isFixed =  top <= 70 ? true : false;
				if(isFixed) {
					$(".nav-header").css("position", "fixed");
					$(".content").css("margin-top", "60px");
					
				} else {
					$(".nav-header").css("position", "relative");
					$(".content").css("margin-top", "0px");
				}
			};
			/*修改按钮 start*/
			var oldCount = $("#textToday").text();
			var newCount = oldCount;
			$("#changeToday").click(function() {
				console.log("oldcount: " + oldCount);
				$("#changeToday").addClass("hide");
				$("#updateToday").removeClass("hide");
				$("#cancelToday").removeClass("hide");
				$("#textToday").addClass("hide");
				$("#inputToday").removeClass("hide");
				$("#inputToday input").val(oldCount);
				$("#inputToday input").focus();
			});
			
			$("#updateToday").click(function() {
				oldCount = newCount;
				console.log("newCount: " + newCount);
				$("#textToday").text(newCount);
				$("#first").text(newCount);
				$("#updateToday").addClass("hide");
				$("#cancelToday").addClass("hide");
				$("#changeToday").removeClass("hide");
				$("#cancelToday").addClass("hide");
				$("#inputToday").addClass("hide");
				$("#textToday").removeClass("hide");
				$("#updateToday").attr("disabled", "disabled").removeClass("btn-active").addClass("btn-disabled");
				$(".error").text("");
			});
			
			$("#cancelToday").click(function() {
				$("#inputToday input").val(oldCount);
				$("#updateToday").addClass("hide");
				$("#cancelToday").addClass("hide");
				$("#changeToday").removeClass("hide");
				$("#cancelToday").addClass("hide");
				$("#inputToday").addClass("hide");
				$("#textToday").removeClass("hide");
				$("#updateToday").attr("disabled", "disabled").removeClass("btn-active").addClass("btn-disabled");
				$(".error").text("");
			});
			/*修改按钮 end*/
			
			/*报数按钮 start*/
			/*
			$(".daily-commit3").click(function() {
				console.log("commit: " + $(this).length);
				console.log("todayNumber: " + todayNumber);
				if (todayNumber) {
					$("#dailyValue").val(todayNumber);
				} else {
					console.log("todayNumber is null!");
				}
			});
			
			$(".daily-commit2").click(function() {
				console.log("commit2: " + $(this).length);
				console.log("todayNumber: " + todayNumber);
				if (todayNumber) {
					$("#dailyValue").val(todayNumber);
				} else {
					console.log("todayNumber is null!");
				}
			});
			*/
			$(".daily-commit").click(function() {
				$.ajax({
					url: "/personalcountoff/countoff",
					method: "POST",
					type: "JSON",
					data: {record_number: newCount},
					success: function(data) {
						console.log(data.message);
						$(".warn").text(data.message);
						$("#tips").removeClass("hide");
						if (null != data.content) {
							var obj = data.content;
							console.log(obj);
							$("#today-count").text(obj.pcoList[0].record_number);
							$("#daily-rank").text(obj.rankMap.daily_rank);
							$("#weekly-total").text(obj.statisticMap.ws_map.weekly_total);
							$("#week-rank").text(obj.rankMap.week_rank);
							$("#month-total").text(obj.statisticMap.ms.month_total);
							$("#month-rank").text(obj.rankMap.month_rank);
							$("#year-total").text(obj.statisticMap.ys.year_total);
							$("#year-rank").text(obj.rankMap.year_rank);
							$("#year-avg").text(obj.statisticMap.ys.year_total);
						}
						setTimeout(function() {
							$("#tips").addClass("hide");
						}, 2000);
					},
					error: function() {
						console.log("系统异常，请联系管理员！");
					}
				});
				/* var date = $("#serverTime").val();
				console.log("date: " + date);
				var stageValue = $("#dailyValue").val();
				console.log(stageValue);
				var figure_height = $(".content").height();
				console.log("daily:" + figure_height);
				if (stageValue) {
					if (todayNumber) {
						$("#inputToday input").val(stageValue);
						console.log(todayNumber);
						$("#textToday").text(stageValue);
					} else {
						var str = "<div class='row'  style='width: 100%; margin: 5px 0; text-align: center;'>" + 
									"<div class='col-xs-6' style='padding: 2px 0; text-align: left;'>" +
									date + 
									"</div><div id='textToday' class='col-xs-4' style='padding: 2px 0; text-align: center;'>" +
									stageValue + 
									"</div>" +
									"<div id='inputToday' class='col-xs-4 hide' style='padding: 2px 0; text-align: center;'>" +
									"<input type='number' value='" + 
									stageValue + 
									"' style='width: 100%; text-align: center; background-color: rgba(0, 0, 0, 0); border: none; border-bottom: 1px solid #ff7500;'/>" +
									"</div>" +
									"<div class='col-xs-2' style='padding: 2px 0; text-align: right;'>" +
										"<button type='button' onclick='javascript: commit();' class='btn btn-danger btn-xs daily-commit2' data-toggle='modal' data-target='#baoshuDialog' style='font-size: 15px; background-color: #efab5b; border-color: #d67a00; margin: 5px 5px 15px;'>修改</button>" +
									"</div>" +
									"</div>"
						$(".number-record").prepend(str);
					}
					$("#baoshuDialog").modal("hide");
					todayNumber = stageValue;
					$(".figure").css("height", figure_height + 30 + "px");

				} else {
					console.log('stageValue 不合法!');
				} */
			});
			
			$("#inputToday input").keyup(function() {
				newCount = $(this).val();
				console.log("newCount:" + newCount);
				console.log(newCount == oldCount);
				if (newCount != oldCount) {
					if (countoffReg.test($(this).val())) {
						$("#updateToday").removeAttr("disabled").removeClass("btn-disabled").addClass("btn-active");
						$(".error").text("");
					} else {
						$("#updateToday").attr("disabled", "disabled").removeClass("btn-active").addClass("btn-disabled");
						$(".error").text("请输入1-9999之间的正整数!");
					}
				} else {
					$("#updateToday").attr("disabled", "disabled").removeClass("btn-active").addClass("btn-disabled");
					$(".error").text("");
				}
			});
			
			/*报数按钮 end*/
			
			$(".mod_aside_v2_nav_btn").click(function() {
				var className = $(".mod_aside_v2_nav i").attr("class");
				if (typeof(className) == "undefined") {
					$(".mod_aside_v2_nav i").text("收起");
					$(".mod_aside_v2_nav i").attr("class", "unfold");
					$(".mod_aside_v2_nav").css("-webkit-transform", "translate3d(0,0,0)")
						.css("transform", "translate3d(0,0,0)");
					$(".mod_aside_v2_mask").css("opacity", "1")
						.css("display", "block");
				} else {
					console.log(className);
					$(".mod_aside_v2_nav i").text("我的信息");
					$(".mod_aside_v2_nav i").removeAttr("class");
					$(".mod_aside_v2_nav").css("-webkit-transform", "")
						.css("transform", "");
					$(".mod_aside_v2_mask").css("opacity", "0")
						.css("display", "none");
				}
				/*
				mod_aside_v2_mask opcity 1 dispaly: none
				mod_aside_v2_nav -webkit-transform: translate3d(0,0,0);
			    transform: translate3d(0,0,0);
				*/
			});
		});
	</script>
  </body>
</html>
